# dev 0 is CIO
# dev 1 is ROM
goto MAIN
DEVICE_CODE_BEGIN:
xch r0, r0
ret
MAIN:
# read rom into main memory
rmp r2 # r2 = memory_ptr
rdb dev1, 0x2 # read the program length
ld r0 # load program length into r0
acr rF, 0x2
ar rE, rF
dps dev1 # dev1.mem_ptr = 2
LOOP_TOP:
snec r0, 0x0
goto LOOP_END
smp 0x2 # memory_ptr = 0x0
rdb dev1, 0x2
adc rF, 0x2
dps dev1
call DEVICE_CODE_BEGIN
sub r0, rE # decrement r0
goto LOOP_TOP
LOOP_END:
ret